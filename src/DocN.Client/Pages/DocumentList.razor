@page "/documents"
@using MudBlazor

<PageTitle>Documenti - DocN</PageTitle>

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center" Class="mb-4">
        <MudText Typo="Typo.h3">ðŸ“„ Gestione Documenti</MudText>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" 
                   StartIcon="@Icons.Material.Filled.Upload" Href="/upload">
            Carica Documento
        </MudButton>
    </MudStack>
    
    <MudCard Elevation="2">
        <MudCardContent>
            <!-- Search and Filters -->
            <MudGrid Class="mb-4">
                <MudItem xs="12" md="6">
                    <MudTextField T="string" @bind-Value="searchQuery" 
                                  Label="Cerca documenti" 
                                  Variant="Variant.Outlined"
                                  Adornment="Adornment.Start" 
                                  AdornmentIcon="@Icons.Material.Filled.Search" />
                </MudItem>
                <MudItem xs="12" md="3">
                    <MudSelect T="string" @bind-Value="filterCategory" Label="Categoria" Variant="Variant.Outlined">
                        <MudSelectItem Value="@("")">Tutte</MudSelectItem>
                        <MudSelectItem Value="@("Contratti")">Contratti</MudSelectItem>
                        <MudSelectItem Value="@("Fatture")">Fatture</MudSelectItem>
                        <MudSelectItem Value="@("Report")">Report</MudSelectItem>
                        <MudSelectItem Value="@("Manuali")">Manuali</MudSelectItem>
                        <MudSelectItem Value="@("Policy")">Policy</MudSelectItem>
                        <MudSelectItem Value="@("Corrispondenza")">Corrispondenza</MudSelectItem>
                        <MudSelectItem Value="@("Legale")">Legale</MudSelectItem>
                        <MudSelectItem Value="@("HR")">HR</MudSelectItem>
                        <MudSelectItem Value="@("Altro")">Altro</MudSelectItem>
                    </MudSelect>
                </MudItem>
                <MudItem xs="12" md="3">
                    <MudSelect T="string" @bind-Value="sortBy" Label="Ordina per" Variant="Variant.Outlined">
                        <MudSelectItem Value="@("recent")">PiÃ¹ recenti</MudSelectItem>
                        <MudSelectItem Value="@("name")">Nome</MudSelectItem>
                        <MudSelectItem Value="@("size")">Dimensione</MudSelectItem>
                        <MudSelectItem Value="@("category")">Categoria</MudSelectItem>
                    </MudSelect>
                </MudItem>
            </MudGrid>
            
            <!-- Documents Table -->
            <MudTable Items="@documents" Hover="true" Striped="true" Dense="true" Loading="@isLoading">
                <HeaderContent>
                    <MudTh>Nome</MudTh>
                    <MudTh>Categoria</MudTh>
                    <MudTh>Dimensione</MudTh>
                    <MudTh>Caricato il</MudTh>
                    <MudTh>VisibilitÃ </MudTh>
                    <MudTh Style="text-align: right">Azioni</MudTh>
                </HeaderContent>
                <RowTemplate>
                    <MudTd DataLabel="Nome">
                        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                            <MudIcon Icon="@GetFileIcon(context.ContentType)" Size="Size.Small" />
                            <MudText>@context.FileName</MudText>
                        </MudStack>
                    </MudTd>
                    <MudTd DataLabel="Categoria">
                        <MudChip Size="Size.Small" Color="@GetCategoryColor(context.Category)">
                            @context.Category
                        </MudChip>
                    </MudTd>
                    <MudTd DataLabel="Dimensione">@context.FileSize</MudTd>
                    <MudTd DataLabel="Caricato il">@context.UploadedAt</MudTd>
                    <MudTd DataLabel="VisibilitÃ ">
                        <MudIcon Icon="@GetVisibilityIcon(context.Visibility)" Size="Size.Small" />
                    </MudTd>
                    <MudTd DataLabel="Azioni" Style="text-align: right">
                        <MudIconButton Icon="@Icons.Material.Filled.Visibility" Size="Size.Small" 
                                       OnClick="@(() => ViewDocument(context.Id))" />
                        <MudIconButton Icon="@Icons.Material.Filled.Download" Size="Size.Small" 
                                       OnClick="@(() => DownloadDocument(context.Id))" />
                        <MudIconButton Icon="@Icons.Material.Filled.Delete" Size="Size.Small" 
                                       Color="Color.Error"
                                       OnClick="@(() => DeleteDocument(context.Id))" />
                    </MudTd>
                </RowTemplate>
                <NoRecordsContent>
                    <MudText Typo="Typo.body1" Align="Align.Center" Class="py-4">
                        Nessun documento trovato. Inizia caricando il tuo primo documento!
                    </MudText>
                </NoRecordsContent>
            </MudTable>
            
            <!-- Pagination -->
            <MudPagination Count="@totalPages" Selected="@currentPage" SelectedChanged="OnPageChanged" 
                           Class="mt-4" />
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private string searchQuery = "";
    private string filterCategory = "";
    private string sortBy = "recent";
    private bool isLoading = false;
    private int currentPage = 1;
    private int totalPages = 1;
    
    private List<DocumentItem> documents = new();
    
    protected override async Task OnInitializedAsync()
    {
        await LoadDocuments();
    }
    
    private async Task LoadDocuments()
    {
        isLoading = true;
        
        // TODO: Load documents from API
        await Task.Delay(500); // Simulate API call
        
        // Placeholder data
        documents = new List<DocumentItem>();
        
        isLoading = false;
    }
    
    private async Task OnPageChanged(int page)
    {
        currentPage = page;
        await LoadDocuments();
    }
    
    private void ViewDocument(int id)
    {
        // TODO: Navigate to document viewer
    }
    
    private async Task DownloadDocument(int id)
    {
        // TODO: Implement download
    }
    
    private async Task DeleteDocument(int id)
    {
        // TODO: Implement delete with confirmation
    }
    
    private string GetFileIcon(string contentType)
    {
        if (contentType.Contains("pdf")) return Icons.Material.Filled.PictureAsPdf;
        if (contentType.Contains("word")) return Icons.Material.Filled.Description;
        if (contentType.Contains("excel")) return Icons.Material.Filled.TableChart;
        if (contentType.Contains("powerpoint")) return Icons.Material.Filled.Slideshow;
        return Icons.Material.Filled.InsertDriveFile;
    }
    
    private Color GetCategoryColor(string category)
    {
        return category switch
        {
            "Contratti" => Color.Primary,
            "Fatture" => Color.Success,
            "Report" => Color.Warning,
            "Manuali" => Color.Secondary,
            "Policy" => Color.Error,
            _ => Color.Default
        };
    }
    
    private string GetVisibilityIcon(string visibility)
    {
        return visibility switch
        {
            "Private" => Icons.Material.Filled.Lock,
            "Department" => Icons.Material.Filled.Group,
            "Public" => Icons.Material.Filled.Public,
            _ => Icons.Material.Filled.Lock
        };
    }
    
    private class DocumentItem
    {
        public int Id { get; set; }
        public string FileName { get; set; } = "";
        public string ContentType { get; set; } = "";
        public string Category { get; set; } = "";
        public string FileSize { get; set; } = "";
        public string UploadedAt { get; set; } = "";
        public string Visibility { get; set; } = "Private";
    }
}
